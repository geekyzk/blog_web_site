---
title: æ­å»ºç§äººgitlab
layout: post 
---

GitLabæ˜¯ä¸€ä¸ªåˆ©ç”¨`Ruby on Rails`å¼€å‘çš„å¼€æºåº”ç”¨ç¨‹åºï¼Œå®ç°ä¸€ä¸ªè‡ªæ‰˜ç®¡çš„[Git]é¡¹ç›®ä»“åº“ï¼Œå¯é€šè¿‡Webç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººé¡¹ç›®ã€‚

â€‹ä¸Šé¢æ˜¯å¼•ç”¨äº†wikipediaå¯¹GitLabçš„ä»‹ç»ï¼Œæ„Ÿè§‰æ¯”è¾ƒé€šä¿—æ˜“æ‡‚ã€‚GitLabåˆ†ä¸ºå•†ä¸šç‰ˆè¿˜æœ‰ç¤¾åŒºç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸ªäººæ­å»ºæˆ–è€…ä¸€èˆ¬çš„å…¬å¸éƒ½æ˜¯ä½¿ç”¨ç¤¾åŒºç‰ˆæœ¬æ¥æ­å»ºä¸€ä¸ªç§äººçš„gitç®¡ç†å¹³å°ï¼Œæ–¹ä¾¿åœ¨å…¬å¸å†…éƒ¨ç®¡ç†é¡¹ç›®ä»£ç ã€‚

â€‹æ–‡ç« åªæ˜¯å¯¹GitLabè¿›è¡Œäº†ä¸€ä¸ªåŸºç¡€çš„å®‰è£…ï¼Œå½“ç„¶GitLabå¯é…ç½®çš„ä¸œè¥¿è¿˜æ˜¯éå¸¸å¤šçš„ã€‚
---------

## å‡†å¤‡æ¡ä»¶

- Ubuntu 16.04 ç³»ç»Ÿä¸»æœºä¸€å°
- è‰¯å¥½çš„ç½‘ç»œæ¡ä»¶

## å®‰è£…è¿‡ç¨‹

æœ¬æ¬¡æ˜¯åœ¨Ubuntuä¸Šå®‰è£…GitLabç¤¾åŒºç‰ˆæœ¬ï¼Œå½“ç„¶ï¼Œå¦‚æœæ˜¯å…¶ä»–æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹å®˜æ–¹ç½‘ç«™
[GitLabå®˜æ–¹å®‰è£…æ•™ç¨‹]: https://about.gitlab.com/installation/	"GitLabå®˜æ–¹å®‰è£…æ•™ç¨‹"

<!--more-->

###  ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–çš„è½¯ä»¶

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…`curl openssh-server ca-certificates`è¿™ä¸‰ä¸ªä¾èµ–è½¯ä»¶ï¼Œå½“ç„¶ï¼Œæœ‰äº›ç”µè„‘å…¶å®é»˜è®¤å·²ç»å®‰è£…æœ‰äº†ï¼Œä½†æ˜¯ä¸ºäº†é¢„é˜²ä¸‡ä¸€ï¼Œæˆ‘ä»¬è¿˜æ˜¯å†æ‰§è¡Œä¸€éç›¸å…³çš„å®‰è£…å‘½ä»¤

```shell
sudo apt-get install -y curl openssh-server ca-certificates
```

éšåï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…GitLabç”¨äºå‘é€é‚®ä»¶çš„ä¾èµ–è½¯ä»¶**Postfix**ã€‚

```shell
sudo apt-get install -y postfix
```

åœ¨å¼¹å‡ºçš„é…ç½®é¡µé¢ä¸­é€‰æ‹©Internet Siteï¼Œéšåä¸€ç›´é»˜è®¤å›è½¦å³å¯å®‰è£…å®Œæˆ



###  ç¬¬äºŒæ­¥: æ·»åŠ GitLabæºä¸å®‰è£…

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ GitLabæºã€‚

```shell
curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash
```

éšåï¼Œå¼€å§‹å®‰è£…GitLabã€‚

```shell
sudo apt-get install gitlab-ce
```

æœ€åï¼Œè¿è¡Œé…ç½®å‘½ä»¤ï¼Œé…ç½®ä¸å¯åŠ¨GitLabã€‚

```shell
sudo gitlab-ctl reconfigure
```

åˆ°æ­¤ï¼ŒGitLabå·²ç»æˆåŠŸå®‰è£…å®Œæ¯•ï¼ŒGitLabçš„é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·åä¸ºrootï¼Œå½“å®‰è£…æˆåŠŸåï¼Œé»˜è®¤webç¨‹åºä¼šç›‘å¬åœ¨80ç«¯å£ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è®¿é—®webé¡µé¢ï¼Œå°±ä¼šæç¤ºæˆ‘ä»¬æ›´æ”¹rootè´¦å·çš„å¯†ç ï¼Œå½“è®¾ç½®å®Œæ¯•åï¼Œä¸€ä¸ªç®€å•çš„GitLabå®‰è£…ä¹Ÿå°±å®Œæˆã€‚

> sudo gitlab-ctl reconfigure è¿™æ¡å‘½ä»¤åœ¨æˆ‘ä»¬æ¯æ¬¡ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œéƒ½éœ€è¦è¿è¡Œä¸€éï¼Œè®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ

##  GitLabé…ç½®

GitLabä¼šå®‰è£…è®¸å¤šçš„é»˜è®¤é…å¥—çš„è½¯ä»¶ï¼Œè¿™ä¹Ÿä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ç³»ç»Ÿå·²ç»æœ‰ç›‘å¬åœ¨80ç«¯å£çš„webç¨‹åºäº†ï¼Œå½“æˆ‘ä»¬å¯åŠ¨GitLabæ—¶ï¼Œå°±ä¼šé€ æˆå†²çªï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä¿®æ”¹GitLabçš„é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹é»˜è®¤ç«¯å£.

GitLabç”±ä»¥ä¸‹æœåŠ¡æ„æˆï¼š

- `nginx`ï¼šé™æ€WebæœåŠ¡å™¨
- `gitlab-shell`ï¼šç”¨äºå¤„ç†Gitå‘½ä»¤å’Œä¿®æ”¹authorized keysåˆ—è¡¨
- `gitlab-workhorse`:è½»é‡çº§çš„åå‘ä»£ç†æœåŠ¡å™¨
- `logrotate`ï¼šæ—¥å¿—æ–‡ä»¶ç®¡ç†å·¥å…·
- `postgresql`ï¼šæ•°æ®åº“
- `redis`ï¼šredisç¼“å­˜æ•°æ®åº“
- `sidekiq`ï¼šç”¨äºåœ¨åå°æ‰§è¡Œé˜Ÿåˆ—ä»»åŠ¡ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰
- `unicorn`ï¼šAn HTTP server for Rack applicationsï¼ŒGitLab Railsåº”ç”¨æ˜¯æ‰˜ç®¡åœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šé¢çš„ã€‚

ä»¥ä¸Šçš„ç»„ä»¶ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯å¯ä»¥æ›¿æ¢æˆè‡ªå·±å·²ä½¿ç”¨çš„ç»„ä»¶ã€‚

### é…ç½®ä¸€ï¼šä¿®æ”¹gitlabåœ°å€å’Œç«¯å£

> external_url 'http://192.168.4.208'

åœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰**external_url** è¿™ä¸€é¡¹ï¼Œè¿™å°±æ˜¯é…ç½®gitlabçš„åœ°å€ï¼Œå½“æˆ‘ä»¬éœ€è¦æ”¹å˜ç«¯å£æ—¶ï¼Œå¯ä»¥åŠ ä¸Šç«¯å£é…ç½®å¦‚:

` external_url 'http://192.168.4.208:90'` (äº²æµ‹æ˜¯ğŸ‘Œçš„)

å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥é…ç½®æˆåŸŸåçš„å½¢å¼

> æ³¨æ„ï¼Œä½œè€…åˆšå¼€å§‹ä¹Ÿæƒ³ç»‘å®š8080ç«¯å£ï¼Œä½†æ˜¯8080ç«¯å£å·²ç»è¢«gitlabçš„å…¶ä»–æœåŠ¡(unicorn)ä½¿ç”¨ï¼Œå› æ­¤ç»‘å®šæ˜¯ä¸æˆåŠŸçš„ï¼Œé™¤éä¿®æ”¹å…¶ä»–æœåŠ¡çš„é»˜è®¤ç«¯å£ã€‚
>
> è¦å–„äºæŸ¥çœ‹æ—¥å¿—ã€‚æ—¥å¿—ä¸­ä¼šåŒ…å«æœ‰é”™è¯¯ä¿¡æ¯å’ŒåŸå› ï¼Œè¿™æ ·ä¼šæ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾å¹¶è§£å†³



### é…ç½®äºŒ: é…ç½®å‘é€é‚®ä»¶é‚®ç®±

é¦–å…ˆï¼Œé…ç½®å‘é€çš„é‚®ç®±å¿…é¡»å¼€å¯äº†smtpåŠŸèƒ½ï¼Œgitlabé…ç½®å…·ä½“å¦‚ä¸‹

```properties
### Email Settings
gitlab_rails['gitlab_email_enabled'] = true
# å‘é€é‚®ä»¶çš„é‚®ç®±åœ°å€
gitlab_rails['gitlab_email_from'] = 'example@163.com'
# å‘é€é‚®ä»¶çš„æ ‡é¢˜
gitlab_rails['gitlab_email_display_name'] = 'example_lab'
gitlab_rails['gitlab_email_reply_to'] = 'example@163.com'
```

```properties
###! **Use smtp instead of sendmail/postfix.**
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.163.com"
gitlab_rails['smtp_port'] = 25
gitlab_rails['smtp_user_name'] = "example@163.com"
gitlab_rails['smtp_password'] = "password"
gitlab_rails['smtp_domain'] = "163.com"
gitlab_rails['smtp_authentication'] = "login"
gitlab_rails['smtp_enable_starttls_auto'] = true
```

å¿…é¡»é…ç½®è¿™ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œéšåè¿è¡Œ`sudo gitlab-ctl reconfigure`å‘½ä»¤æ¥ä½¿é…ç½®ç”Ÿæ•ˆå³å¯ï¼Œå½“é‚€è¯·åˆ«äººåˆ°é¡¹ç›®ç­‰åŠ¨ä½œæ—¶ï¼Œå°±ä¼šè‡ªåŠ¨å‘é€é‚®ä»¶åˆ°è¢«é‚€è¯·äººé‚®ç®±ä¸­ã€‚